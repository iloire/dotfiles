#!/bin/bash
# Category: project
# Description: Launch VS Code with predefined project folders or workspaces

# VS Code launcher script with predefined folder mappings and workspace support
# Usage: c <name>

WORKSPACES_DIR="$HOME/myconfig/organize-workspaces/workspaces"

# Command definitions: "command:description:path[:extra_paths...]"
declare -a COMMANDS=(
    "calma:Opens lacalmaeduca.com project:$HOME/code/lacalmaeduca.com/www-site"
    "dotfiles:Opens dotfiles directory:$HOME/dotfiles"
    "hosts:Opens hosts file:/etc/hosts"
    "ansible:Opens ansible directory:$HOME/code/ansible-recipes"
    "nas:Opens NAS-peque repos (ansible-nas + inventory):$HOME/code/NAS-peque/ansible-nas:$HOME/code/NAS-peque/my-ansible-nas-inventory"
    "n8n:Opens my-n8n project:$HOME/code/my-n8n"
    "notes:Opens notes directory:$HOME/notes"
)

# Collect workspace names from .code-workspace files
get_workspaces() {
    if [ -d "$WORKSPACES_DIR" ]; then
        for f in "$WORKSPACES_DIR"/*.code-workspace; do
            [ -f "$f" ] || continue
            basename "$f" .code-workspace
        done
    fi
}

show_help() {
    echo "Usage: c <name>"
    echo
    echo "Workspaces (from $WORKSPACES_DIR):"
    for ws in $(get_workspaces); do
        printf "  %-18s - Opens %s workspace\n" "$ws" "$ws"
    done
    echo
    echo "Folders:"
    for cmd in "${COMMANDS[@]}"; do
        IFS=':' read -r name desc path <<< "$cmd"
        printf "  %-18s - %s\n" "$name" "$desc"
    done
}

if [ $# -eq 0 ]; then
    show_help
    exit 1
fi

# Check for a matching workspace file first
ws_file="$WORKSPACES_DIR/$1.code-workspace"
if [ -f "$ws_file" ]; then
    code -n "$ws_file"
    exit 0
fi

# Fall back to command definitions
for cmd in "${COMMANDS[@]}"; do
    IFS=':' read -r name desc paths <<< "$cmd"
    if [ "$1" = "$name" ]; then
        IFS=':' read -ra path_array <<< "$paths"
        code -n "${path_array[@]}"
        exit 0
    fi
done

echo "Unknown name: $1"
echo
show_help
exit 1