#!/bin/bash
# Category: files
# Description: Show disk usage with color-coded sizes

# Color definitions using $'...' syntax for portability
GREEN=$'\033[1;32m'
YELLOW=$'\033[1;33m'
RED=$'\033[1;31m'
MAGENTA=$'\033[1;35m'
BLUE=$'\033[1;34m'
RESET=$'\033[0m'

# Function to display usage
usage() {
	echo "Usage: $0 [directory]"
	exit 1
}

# Check if a directory is provided as an argument; otherwise, use the current directory
DIRECTORY="${1:-.}"

# Check if the provided directory exists
if [ ! -d "$DIRECTORY" ]; then
	echo "Error: Directory $DIRECTORY does not exist."
	usage
fi

# Function to apply colors based on size
colorize_size() {
	SIZE=$1
	ITEM=$2

	# Determine the color based on size
	if [[ $SIZE == *K ]]; then
		COLOR="$GREEN"
	elif [[ $SIZE == *M ]]; then
		COLOR="$YELLOW"
	elif [[ $SIZE == *G ]]; then
		COLOR="$RED"
	elif [[ $SIZE == *T ]]; then
		COLOR="$MAGENTA"
	else
		COLOR="$BLUE"
	fi

	# Print the colored output
	printf '%s%s\t%s%s\n' "$COLOR" "$SIZE" "$ITEM" "$RESET"
}

# List the space taken in the directory with a nice format and colors
printf '%sSpace taken in directory: %s%s\n' "$BLUE" "$DIRECTORY" "$RESET"
if [[ "$(uname)" == "Darwin" ]]; then
	DU_CMD="du -h -d 1"
else
	DU_CMD="du -h --max-depth=1"
fi

$DU_CMD "$DIRECTORY" | sort -h | while read size item; do
	colorize_size "$size" "$item"
done
